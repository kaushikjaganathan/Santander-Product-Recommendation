# Santander Product Recommendation

### Abstract

Santander is a multinational bank in Spain offering an array of financial services and products. Under their current system, a small number of Santander’s customers receive many recommendations while many others rarely see any resulting in an uneven customer experience. Models were built to aid the bank in selling products through mass marketing as well as personalized recommendations.
Customers were segmented based on the number of relations they held with the bank. All customers having more than two accounts were considered and equal width segmentation was applied. Market basket analysis was performed in all three segments and the association rules derived from each segment were used to select the potential products for mass marketing strategies. Those products in rules which had a high lift and low expected confidence were identified as high potential low selling products which could be mass marketed. 
Santander’s core business involves a client relationship manager guiding a client’s investment decisions.  Recommender systems can aid relationship managers with making personalized and automated selection of next best products for private banking clients. Different types of collaborative filtering recommender systems were built to help select the next best offer. Since the data had information only about the presence or absence of a product with a customer, Implicit Feedback CF with Alternating Least Squares was implemented where products were modelled as a function of Preference and Confidence. This system was improved by a user-user similarity-based system and further enhanced by incorporating demographic correlations. For the enhanced model, pairwise user-user similarity using cosine similarity using user-demography vectors was calculated. For each user, based on the enhanced similarity scores, 1000 users were identified using the k-Nearest Neighbors technique. The items to be recommended were predicted as a weighted average of the preferences from each user’s neighborhood. Precision and Recall @ K were used to evaluate the recommender systems.  
Index terms – Equal width segmentation, market basket analysis, association rules, recommender systems, implicit feedback collaborative filtering, alternating least squares, demographic correlations.

### Introduction

Banco Santander, S.A., doing business as Santander Group, is a Spanish multinational commercial bank and financial services company founded and based in Santander, Spain. It offers an array of financial services and products including retail banking, mortgages, corporate banking, cash management, credit card, capital markets, trust and wealth management, and insurance. The bank is interested in improving its personal product recommendation system for its customers. It collects marketing information about its customers and associates it with bank account products. Under their current system, a small number of Santander’s customers receive many recommendations while many others rarely see any resulting in an uneven customer experience. With an effective recommendation system in place, Santander can better meet the individual needs of all customers and ensure their satisfaction.

### Research Article Review

#### Collaborative Filtering for Implicit Feedback datasets

As the Santander bank’s product ownership data contains only unary indicators of product ownership, recommending products to customers is not possible by implementations of traditional recommender systems, which work on explicit feedback data of preference like review ratings provided by users. As the data contained in the dataset is implicit feedback, there is a need to model this data to be suitable for use with Collaborative filtering algorithms. This research paper by “Collaborative Filtering for Implicit Feedback Datasets” Yifan Hu, Yehuda Koren, Chris Volinsky provides a method to model the implicit feedback as a function of preference(p) and confidence(c) by assigning user owned accounts a positive preference with a high confidence and the accounts the user never interacted with a negative preference with a low confidence. Their approach suggests the usage of this modelled data in a traditional collaborative filtering by matrix factorization algorithm where the input user-item matrix is factorized into user and item factors whose product produces the predicted rating. Also, their implementation of the algorithm involves performing the matrix factorization using Alternating Least Squares method, as the user-item factor product term in the objective function makes it non-convex, so traditional optimization methods like gradient descent consume a lot of memory and run for more iterations. Since the Santander dataset contains data of around 0.68M customers, there is a requirement for an efficient optimization method, and ALS improves on the matrix factorization by setting the one of the user and item factors to a constant in alternative iterations and the other one as the one to be optimized. So, we’ve chosen to implement this algorithm to build the recommender system for the project, using it’s implementation as a Python library called IMPLICIT.

#### Collaborative filtering enhanced by demographic correlations

The implicit feedback data of product ownership in the Santander is not very rich due to it’s sparsity in terms of ownership as around 50% customers own 3 products or less and the product portfolio only comprises of 24 products so the recommender system might not perform well. Also, in the banking industry, the predominant features used to profile customers by similarity are the demographics, and based on our EDA and segmentation exercises we have seen that these features offer separability in purchase preferences, so we looked to add the demographic information to the recommender system model in motive to enhance its predictive power. To do this, we tended to a research paper “Collaborative Filtering Enhanced By Demographic Correlations” by Manolis Vozalis and Konstantinos G. Margaritis which provides a methodology to enhance a base USER-USER similarity based Collaborative filtering algorithm by incorporating demographic correlations. The research paper provides a method to factor in similarities between users in terms of their demographics alongside their product preference and produce an enhanced similarity measure, which can be used to weight products owned to product recommendations for each user. So, we’ve chosen to implement this algorithm to build an enhanced recommender system over the baseline user-user similarity based collaborative filtering recommender system.

### Objective

In this project, we will analyze the Santander’s bank customer profiles, data, products and transactions. Our aim is to predict which products their existing customers will use in the next month based on their past behavior and that of similar customers.  The analysis will include the following:  
a.	Identify different approaches of segmentation based on customer’s needs or values to market products and select the best approach
b.	Perform Market Basket Analysis for the segments in the best segmentation approach and market the rules through different techniques.
c.	Build recommendation engine to engage in personalized marketing.

### Dataset Description

The dataset was sourced from https://www.kaggle.com/c/santander-product-recommendation/data. The dataset contains 1.5 years of customers behavior data from Santander bank to predict what new products customers will purchase. The data starts at 2015-01-28 and has monthly records of products a customer has, such as "credit card", "savings account", etc. The training data consists of nearly 1 million users with monthly historical user and product data between January 2015 and May 2016. User data consists of 24 predictors including the age and income of the users. Product data consists of Boolean flags for all 24 products and indicates whether the user owned the product in the respective months. This sample does not include any real Santander Spain customers, and thus it is not representative of Spain's customer base.

### Data Preparation and Integration

Data preparation consist of removing irrelevant data, imputing missing values, excluding skewed variables, recoding variables and performing feature engineering. Since the last month data was to be analyzed, it was extracted at the beginning.
As we inspect the missing value data pattern, the columns, 'last_date_as_primary' and 'spouse_index', had more than 99% of missing values. These two columns were removed. Next, the rows with missing value in other columns such as ‘province_name’ that was less than 0.5% were removed as they were observed to be non-contributory to the analysis. The calculation for the median ‘gross_income’ of each province were performed to prepare for value imputation. The missing values were imputed with the median values of the gross income based on province. Since the dataset was obtained from a Spanish company, the variables were recoded from Spanish notation to English Notation to achieve readability and clarity. For example, gender acronym was recoded from ‘H’ and ‘V’ to ‘F’ and ‘M’ respectively.
The dataset was further examined by checking the distribution of continuous and nominal variables. For continuous variables, the 'seniority' variable had outliers which were removed as they had invalid values of ‘-99999’. The figure below shows the distribution of the continuous variables before processing.

![F1 distribution](/Images/F1.png)

For nominal variables, 'country_of_residence', 'employee_index', 'deceased_index', 'customer_type' variables had a notably minimum of 99.8% of records that had the same value. The distributions can be seen in the figures below.

![F2 distribution](/Images/F2.png)

For 'country_of_residence', customers from other values except ‘ES’ were removed since the small records could not be analysed objectively. Thus, the records of variables 'customer_type', 'country_of_residence', 'employee_index', 'customer_typ_at_begin', 'residency_index' and 'deceased_index' were removed using this similar method. Furthermore, these columns were removed which were observed to have only one level of data. The variables, 'date_of_first_contract', 'address_type', 'province_code' and 'channel_used' were observed to be correlated or could be inferred to another variable. In particular,  ‘date_of_first_contract’ was removed because it was correlated with ‘seniority’. ‘address_type’ and ‘province_code’ were removed because they could be inferred from ‘province_name’ and ‘channel_used’ was removed because the data dictionary did not provide further elaboration on the meaning of the values displayed.  
In Feature Engineering, the provinces were group based on their GDP resulting in a new column ‘province_segment’, and a new column ‘No. of Accounts’ were created to show the number of accounts that a customer holds. Customers with no accounts were then removed. The final data after cleaning and preparation has 689449 rows with 35 columns.

